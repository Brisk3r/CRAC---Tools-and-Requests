<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRAC Rules Database</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- PapaParse for CSV handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #1e293b;
        }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .card-hover {
            transition: all 0.2s ease-in-out;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col relative">

    <!-- Header -->
    <header class="bg-blue-900 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-4 py-4 flex flex-col sm:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3 cursor-pointer" onclick="showHome()">
                <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-blue-900 font-bold text-xl shadow-md">
                    <i class="fa-solid fa-water"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold leading-tight">Clarence Regional Aquatic Centre</h1>
                    <p class="text-xs text-blue-200">Staff Rules Database</p>
                </div>
            </div>
            
            <!-- Global Search (Hidden on Home, Shown in Views) -->
            <div id="globalSearchContainer" class="hidden relative w-full sm:w-80">
                <input type="text" id="searchInput" placeholder="Search database..." 
                    class="w-full pl-10 pr-4 py-2 rounded-lg text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-400 shadow-inner bg-blue-50/10 placeholder-blue-300 text-white border border-blue-700/50 transition-all">
                <i class="fa-solid fa-magnifying-glass absolute left-3 top-3 text-blue-300"></i>
            </div>
        </div>
    </header>

    <!-- HOME VIEW (Dashboard) -->
    <div id="homeView" class="flex-grow flex flex-col items-center justify-center p-6 fade-in">
        <div class="max-w-4xl w-full text-center mb-8">
            <h2 class="text-3xl font-bold text-slate-800 mb-2">Select a Category</h2>
            <p class="text-slate-500">Access specific area rules and conditions</p>
            <p id="dbStatus" class="text-xs text-slate-400 mt-2 hidden"><i class="fa-solid fa-database mr-1"></i> Live Database Connected</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl w-full">
            <!-- Entry Button -->
            <button onclick="filterCategory('Admission')" class="group glass-panel p-8 rounded-2xl text-left hover:bg-blue-50 transition-all border-l-8 border-blue-500 shadow-sm hover:shadow-lg relative overflow-hidden">
                <div class="absolute right-[-20px] bottom-[-20px] text-blue-100 text-9xl transition-transform group-hover:scale-110 group-hover:rotate-12">
                    <i class="fa-solid fa-ticket"></i>
                </div>
                <div class="relative z-10">
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center text-blue-600 text-2xl mb-4 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                        <i class="fa-solid fa-door-open"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800">Conditions of Entry</h3>
                    <p class="text-sm text-slate-500 mt-2">General admission, fees, hygiene, and supervision policies.</p>
                </div>
            </button>

            <!-- Learn to Swim Button -->
            <button onclick="filterCategory('Learn to Swim')" class="group glass-panel p-8 rounded-2xl text-left hover:bg-indigo-50 transition-all border-l-8 border-indigo-500 shadow-sm hover:shadow-lg relative overflow-hidden">
                <div class="absolute right-[-20px] bottom-[-20px] text-indigo-100 text-9xl transition-transform group-hover:scale-110 group-hover:rotate-12">
                    <i class="fa-solid fa-person-swimming"></i>
                </div>
                <div class="relative z-10">
                    <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center text-indigo-600 text-2xl mb-4 group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                        <i class="fa-solid fa-graduation-cap"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800">Learn to Swim</h3>
                    <p class="text-sm text-slate-500 mt-2">Student policies, payments, missed lessons, and parent duties.</p>
                </div>
            </button>

            <!-- Squads Button -->
            <button onclick="filterCategory('Squads')" class="group glass-panel p-8 rounded-2xl text-left hover:bg-teal-50 transition-all border-l-8 border-teal-500 shadow-sm hover:shadow-lg relative overflow-hidden">
                <div class="absolute right-[-20px] bottom-[-20px] text-teal-100 text-9xl transition-transform group-hover:scale-110 group-hover:rotate-12">
                    <i class="fa-solid fa-stopwatch"></i>
                </div>
                <div class="relative z-10">
                    <div class="w-12 h-12 bg-teal-100 rounded-xl flex items-center justify-center text-teal-600 text-2xl mb-4 group-hover:bg-teal-600 group-hover:text-white transition-colors">
                        <i class="fa-solid fa-people-group"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800">Squads</h3>
                    <p class="text-sm text-slate-500 mt-2">Training etiquette, coaching directives, and lane discipline.</p>
                </div>
            </button>

            <!-- Waterslide Button -->
            <button onclick="filterCategory('Waterslide')" class="group glass-panel p-8 rounded-2xl text-left hover:bg-pink-50 transition-all border-l-8 border-pink-500 shadow-sm hover:shadow-lg relative overflow-hidden">
                <div class="absolute right-[-20px] bottom-[-20px] text-pink-100 text-9xl transition-transform group-hover:scale-110 group-hover:rotate-12">
                    <i class="fa-solid fa-water-ladder"></i>
                </div>
                <div class="relative z-10">
                    <div class="w-12 h-12 bg-pink-100 rounded-xl flex items-center justify-center text-pink-600 text-2xl mb-4 group-hover:bg-pink-600 group-hover:text-white transition-colors">
                        <i class="fa-solid fa-circle-exclamation"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800">Waterslides</h3>
                    <p class="text-sm text-slate-500 mt-2">Height/Weight limits, riding position, medical warnings, and attire.</p>
                </div>
            </button>
        </div>

        <button onclick="filterCategory('all')" class="mt-8 text-slate-500 hover:text-blue-600 font-medium text-sm flex items-center gap-2 transition-colors">
            <i class="fa-solid fa-list"></i> View All Database Entries
        </button>
    </div>

    <!-- MAIN CONTENT VIEW (Rules List) -->
    <div id="mainContentView" class="hidden flex-grow flex flex-col">
        <!-- Filter Bar -->
        <div class="bg-white border-b border-slate-200 sticky top-[88px] sm:top-[72px] z-40 shadow-sm">
            <div class="max-w-5xl mx-auto px-4 py-3 overflow-x-auto no-scrollbar">
                <div class="flex gap-2" id="filterContainer">
                    <button onclick="showHome()" class="px-3 py-1.5 rounded-full text-sm font-medium text-slate-500 hover:bg-slate-100 transition-colors border border-transparent">
                        <i class="fa-solid fa-arrow-left"></i> Home
                    </button>
                    <div class="w-px h-6 bg-slate-300 mx-1 self-center"></div>
                    <button onclick="filterCategory('all')" class="filter-btn active bg-blue-900 text-white px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors shadow-sm">
                        All Rules
                    </button>
                    <button onclick="filterCategory('Admission')" class="filter-btn bg-slate-100 text-slate-600 hover:bg-slate-200 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors">
                        Entry
                    </button>
                    <button onclick="filterCategory('Learn to Swim')" class="filter-btn bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-100 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors">
                        LTS
                    </button>
                    <button onclick="filterCategory('Squads')" class="filter-btn bg-teal-50 text-teal-700 hover:bg-teal-100 border border-teal-100 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors">
                        Squads
                    </button>
                    <button onclick="filterCategory('Waterslide')" class="filter-btn bg-pink-50 text-pink-700 hover:bg-pink-100 border border-pink-100 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors">
                        Slide
                    </button>
                    <button onclick="filterCategory('Safety')" class="filter-btn bg-slate-100 text-slate-600 hover:bg-slate-200 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors">
                        Safety
                    </button>
                    <button onclick="filterCategory('Hygiene')" class="filter-btn bg-slate-100 text-slate-600 hover:bg-slate-200 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors">
                        Hygiene
                    </button>
                </div>
            </div>
        </div>

        <!-- Scrollable Content -->
        <main class="flex-grow p-4 bg-slate-50">
            <div class="max-w-5xl mx-auto">
                <!-- Dynamic Category Header -->
                <div id="categoryHeader" class="mb-6 fade-in hidden">
                    <h2 id="categoryTitle" class="text-2xl font-bold text-slate-800"></h2>
                    <p id="categoryDesc" class="text-slate-500 text-sm"></p>
                </div>

                <!-- Alert Box (Context Sensitive) -->
                <div id="alertBox" class="bg-amber-50 border-l-4 border-amber-500 p-4 mb-6 rounded-r-lg shadow-sm fade-in">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fa-solid fa-triangle-exclamation text-amber-500"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-amber-700">
                                <strong>Staff Note:</strong> Management reserves the right to refuse entry or evict any person for failure to comply.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Results Grid -->
                <div id="resultsGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4 fade-in">
                    <!-- Cards injected here via JS -->
                </div>

                <!-- No Results State -->
                <div id="noResults" class="hidden text-center py-12">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-slate-100 mb-4">
                        <i class="fa-solid fa-clipboard-question text-slate-400 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-slate-900">No matching rules found</h3>
                    <p class="text-slate-500">Try searching for a different keyword.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-800 text-slate-400 py-6 mt-auto">
        <div class="max-w-5xl mx-auto px-4 text-center text-sm">
            <p>&copy; Clarence Regional Aquatic Centre.</p>
            <p class="text-xs mt-1">Internal Reference Database.</p>
        </div>
    </footer>

    <!-- Application Logic -->
    <script>
        // --- CONFIGURATION ---
        // 1. Create a Google Sheet and paste the simplified CSV content into it.
        // 2. Go to File > Share > Publish to web.
        // 3. Select "Comma-separated values (.csv)" from the dropdown.
        // 4. Paste the generated link inside the quotes below.
        const GOOGLE_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTb3ppPMnnD2FEOWux0sHcVVBEO2sAPHBjFYFFZZqy3Zi7EZLJA58lGjAfqWv2jvHNK8bvstkZZa_yu/pub?output=csv"; 

        // --- STYLE LOOKUP SYSTEM ---
        // This is the "Brain" that decides how cards look based on the simple data provided by staff.

        const categoryConfig = {
            'Waterslide': { 
                icon: 'fa-water-ladder', // Default icon if no keyword match
                border: 'border-pink-500', 
                badge: 'text-pink-700 bg-pink-50 border-pink-100',
                iconColor: 'text-pink-600'
            },
            'Learn to Swim': { 
                icon: 'fa-graduation-cap', 
                border: 'border-indigo-500', 
                badge: 'text-indigo-700 bg-indigo-50 border-indigo-100',
                iconColor: 'text-indigo-600'
            },
            'Squads': { 
                icon: 'fa-people-group', 
                border: 'border-teal-500', 
                badge: 'text-teal-700 bg-teal-50 border-teal-100',
                iconColor: 'text-teal-600'
            },
            'Admission': { 
                icon: 'fa-ticket', 
                border: 'border-blue-500', 
                badge: 'text-blue-700 bg-blue-50 border-blue-100',
                iconColor: 'text-blue-600'
            },
            'Supervision': { 
                icon: 'fa-eye', 
                border: 'border-orange-400', 
                badge: 'text-orange-700 bg-orange-50 border-orange-100',
                iconColor: 'text-orange-500'
            },
            'Safety': { 
                icon: 'fa-triangle-exclamation', 
                border: 'border-red-500', 
                badge: 'text-red-700 bg-red-50 border-red-100',
                iconColor: 'text-red-600'
            },
            'Hygiene': { 
                icon: 'fa-hand-sparkles', 
                border: 'border-cyan-500', 
                badge: 'text-cyan-700 bg-cyan-50 border-cyan-100',
                iconColor: 'text-cyan-600'
            },
            // Fallback for unknown categories
            'default': {
                icon: 'fa-info-circle',
                border: 'border-slate-400',
                badge: 'text-slate-700 bg-slate-50 border-slate-200',
                iconColor: 'text-slate-500'
            }
        };

        // This list overrides the default category icon if the TITLE contains a specific word.
        const iconKeywordMap = [
            { keyword: 'Height', icon: 'fa-ruler-vertical' },
            { keyword: 'Weight', icon: 'fa-weight-scale' },
            { keyword: 'Medical', icon: 'fa-heart-pulse' },
            { keyword: 'Health', icon: 'fa-heart-pulse' },
            { keyword: 'Light', icon: 'fa-lightbulb' },
            { keyword: 'Photo', icon: 'fa-camera' },
            { keyword: 'Camera', icon: 'fa-camera' },
            { keyword: 'Nappies', icon: 'fa-baby' },
            { keyword: 'Alcohol', icon: 'fa-wine-glass-slash' },
            { keyword: 'Glass', icon: 'fa-wine-glass-slash' },
            { keyword: 'Smoking', icon: 'fa-smoking-ban' },
            { keyword: 'Diving', icon: 'fa-ban' },
            { keyword: 'Refund', icon: 'fa-hand-holding-dollar' },
            { keyword: 'Fees', icon: 'fa-ticket' },
            { keyword: 'Pass', icon: 'fa-ticket' },
            { keyword: 'Coach', icon: 'fa-bullhorn' },
            { keyword: 'Holiday', icon: 'fa-calendar-day' },
            { keyword: 'Time', icon: 'fa-stopwatch' },
            { keyword: 'Lane', icon: 'fa-arrows-left-right' },
            { keyword: 'Minor', icon: 'fa-child' }
        ];

        function getRuleStyle(rule) {
            // 1. Get Base Style from Category
            const config = categoryConfig[rule.category] || categoryConfig['default'];
            
            // 2. Check for Icon Overrides based on Title
            let finalIcon = config.icon;
            const titleLower = (rule.title || '').toLowerCase();
            
            for (const map of iconKeywordMap) {
                if (titleLower.includes(map.keyword.toLowerCase())) {
                    finalIcon = map.icon;
                    break; // Stop at first match
                }
            }

            return {
                border: config.border,
                badge: config.badge,
                iconColor: config.iconColor,
                icon: finalIcon
            };
        }

        // --- DATA HANDLING ---
        // Fallback data if Sheet fails
        let poolRules = [
             { category: "Waterslide", title: "Height & Weight Limits", content: "Height restriction: Patrons must be a minimum of 1.2m to ride. Maximum weight restriction is 120kg per rider." },
             { category: "Admission", title: "Refusal of Entry", content: "Management reserves the right to refuse entry or evict any person at sole discretion." }
        ];

        // --- APP LOGIC ---
        const homeView = document.getElementById('homeView');
        const mainContentView = document.getElementById('mainContentView');
        const globalSearchContainer = document.getElementById('globalSearchContainer');
        const searchInput = document.getElementById('searchInput');
        const resultsGrid = document.getElementById('resultsGrid');
        const noResults = document.getElementById('noResults');
        const categoryHeader = document.getElementById('categoryHeader');
        const alertBox = document.getElementById('alertBox');
        
        let currentCategory = 'all';

        function init() {
            if (GOOGLE_SHEET_URL) {
                Papa.parse(GOOGLE_SHEET_URL, {
                    download: true,
                    header: true,
                    complete: function(results) {
                        if (results.data && results.data.length > 0) {
                            console.log("Loaded rules from Google Sheets");
                            poolRules = results.data;
                            document.getElementById('dbStatus').classList.remove('hidden');
                        }
                    },
                    error: function(err) {
                        console.error("Error loading Google Sheet:", err);
                    }
                });
            }
        }

        function showHome() {
            mainContentView.classList.add('hidden');
            homeView.classList.remove('hidden');
            globalSearchContainer.classList.add('hidden');
            searchInput.value = ''; // Clear search
        }

        function filterCategory(category) {
            currentCategory = category;
            homeView.classList.add('hidden');
            mainContentView.classList.remove('hidden');
            globalSearchContainer.classList.remove('hidden');
            categoryHeader.classList.remove('hidden');
            alertBox.classList.remove('hidden'); 

            // Header Content Logic
            switch(category) {
                case 'Admission':
                    categoryHeader.innerHTML = `<h2 class="text-2xl font-bold text-blue-900"><i class="fa-solid fa-ticket mr-2"></i>Conditions of Entry</h2><p class="text-slate-500">General admission policies and requirements.</p>`;
                    break;
                case 'Learn to Swim':
                    categoryHeader.innerHTML = `<h2 class="text-2xl font-bold text-indigo-700"><i class="fa-solid fa-graduation-cap mr-2"></i>Learn to Swim</h2><p class="text-slate-500">Lesson policies, payments, and student behaviour.</p>`;
                    break;
                case 'Squads':
                    categoryHeader.innerHTML = `<h2 class="text-2xl font-bold text-teal-700"><i class="fa-solid fa-people-group mr-2"></i>Squads</h2><p class="text-slate-500">Training rules and lane etiquette.</p>`;
                    break;
                case 'Waterslide':
                    categoryHeader.innerHTML = `<h2 class="text-2xl font-bold text-pink-600"><i class="fa-solid fa-water-ladder mr-2"></i>Waterslides</h2><p class="text-slate-500">Safety restrictions, health warnings, and riding rules.</p>`;
                    break;
                default:
                    categoryHeader.innerHTML = `<h2 class="text-2xl font-bold text-slate-800">All Database Entries</h2><p class="text-slate-500">Searching across all facility rules.</p>`;
            }

            // Update Filter Buttons
            const buttons = document.querySelectorAll('.filter-btn');
            buttons.forEach(btn => {
                const btnText = btn.innerText;
                const isSelected = btnText.includes(category === 'all' ? 'All Rules' : category) || 
                                   (category === 'Admission' && btnText.includes('Entry')) ||
                                   (category === 'Learn to Swim' && btnText.includes('LTS')) ||
                                   (category === 'Waterslide' && btnText.includes('Slide'));
                
                btn.className = "filter-btn px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors border";
                
                if (isSelected) {
                    if (category === 'Learn to Swim') btn.classList.add('bg-indigo-600', 'text-white', 'border-indigo-600', 'active', 'shadow-sm');
                    else if (category === 'Squads') btn.classList.add('bg-teal-600', 'text-white', 'border-teal-600', 'active', 'shadow-sm');
                    else if (category === 'Waterslide') btn.classList.add('bg-pink-600', 'text-white', 'border-pink-600', 'active', 'shadow-sm');
                    else btn.classList.add('bg-blue-900', 'text-white', 'border-blue-900', 'active', 'shadow-sm');
                } else {
                     if (btnText.includes('LTS')) btn.classList.add('bg-indigo-50', 'text-indigo-700', 'hover:bg-indigo-100', 'border-indigo-100');
                    else if (btnText.includes('Squads')) btn.classList.add('bg-teal-50', 'text-teal-700', 'hover:bg-teal-100', 'border-teal-100');
                    else if (btnText.includes('Slide')) btn.classList.add('bg-pink-50', 'text-pink-700', 'hover:bg-pink-100', 'border-pink-100');
                    else btn.classList.add('bg-slate-100', 'text-slate-600', 'hover:bg-slate-200', 'border-transparent');
                }
            });

            renderCards();
        }

        function renderCards() {
            resultsGrid.innerHTML = '';
            const query = searchInput.value.toLowerCase();
            
            const filtered = poolRules.filter(rule => {
                const matchesSearch = (rule.title || '').toLowerCase().includes(query) || 
                                      (rule.content || '').toLowerCase().includes(query) || 
                                      (rule.keywords || '').toLowerCase().includes(query);
                
                let matchesCategory = false;
                if (currentCategory === 'all') matchesCategory = true;
                else if (currentCategory === rule.category) matchesCategory = true;
                
                return matchesSearch && matchesCategory;
            });

            if (filtered.length === 0) {
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');
                filtered.forEach(rule => {
                    const card = document.createElement('div');
                    
                    // GET STYLE FROM LOOKUP SYSTEM
                    const style = getRuleStyle(rule);

                    card.className = `glass-panel rounded-xl p-5 card-hover border-l-4 ${style.border}`;
                    
                    card.innerHTML = `
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-bold uppercase tracking-wider px-2 py-0.5 rounded border ${style.badge}">${rule.category}</span>
                            </div>
                            <i class="fa-solid ${style.icon} ${style.iconColor} text-xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800 mb-2">${rule.title}</h3>
                        <p class="text-slate-600 text-sm leading-relaxed">${rule.content}</p>
                    `;
                    resultsGrid.appendChild(card);
                });
            }
        }

        searchInput.addEventListener('input', renderCards);
        init();

    </script>
</body>
</html>
