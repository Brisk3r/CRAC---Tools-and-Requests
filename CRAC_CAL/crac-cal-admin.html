<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path fill='%23007bff' d='M0 50 Q 25 25, 50 50 T 100 50 V 100 H 0 Z' /></svg>">
    <style> body { font-family: 'Inter', sans-serif; } </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <script type="text/babel">
        // --- CONFIGURATION ---
const firebaseConfig = {
  apiKey: "AIzaSyAF44-oMKqTKPcMgOuKfJJqUTJz9JYTHAg",
  authDomain: "osf---availability-roster.firebaseapp.com",
  projectId: "osf---availability-roster",
  storageBucket: "osf---availability-roster.firebasestorage.app",
  messagingSenderId: "1069751236100",
  appId: "1:1069751236100:web:2832210ad7e9ed50e86751",
  measurementId: "G-K5F1SSNK5H"
};
        const ADMIN_PASSWORD = "CRAC*25*"; // IMPORTANT: Change this password
        const TARGET_VENUE = 'CRAC'; // Set to 'CRAC' or 'YCP'
        // ---------------------

        const { useState, useEffect, useMemo } = React;
        let db;
        try {
            if (firebase.apps.length === 0) firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
        } catch(e) { console.error("Firebase init failed", e); }

        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            if (!isAuthenticated) return <Login onAuth={() => setIsAuthenticated(true)} />;
            return <AdminPage />;
        };
        
        const Login = ({ onAuth }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const handleSubmit = (e) => {
                e.preventDefault();
                if (password === ADMIN_PASSWORD) {
                    onAuth(true);
                } else {
                    setError('Incorrect password.');
                }
            };
            return (
                <div className="min-h-screen flex items-center justify-center bg-gray-200">
                    <div className="bg-white p-8 rounded-lg shadow-md w-full max-w-sm">
                        <h2 className="text-2xl font-bold text-center mb-6">Admin Login for {TARGET_VENUE}</h2>
                        <form onSubmit={handleSubmit}>
                            <input type="password" value={password} onChange={e => setPassword(e.target.value)} placeholder="Password" className="w-full p-3 border rounded-lg mb-4"/>
                            {error && <p className="text-red-500 text-sm mb-4">{error}</p>}
                            <button type="submit" className="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700">Login</button>
                        </form>
                    </div>
                </div>
            );
        };

        const AdminPage = () => {
            const [events, setEvents] = useState([]);
            const [settings, setSettings] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [selectedEvent, setSelectedEvent] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [dateFilter, setDateFilter] = useState('all');
            
            useEffect(() => {
                if (!db) { setError("Database not connected."); setIsLoading(false); return; }
                let settingsLoaded = false, eventsLoaded = false;
                const checkLoading = () => { if (settingsLoaded && eventsLoaded) setIsLoading(false); };
                
                const unsubSettings = db.collection('calendar_settings').doc('main_config').onSnapshot(doc => {
                    if (doc.exists) { setSettings(doc.data()); } 
                    else { 
                        const defaultSettings = { 
                            zones: [ { id: '50m Olympic Pool', children: Array.from({length: 8}, (_, i) => ({id: `50m Olympic Pool - Lane ${i+1}`})) }, { id: '25m Lap Pool', children: Array.from({length: 8}, (_, i) => ({id: `25m Lap Pool - Lane ${i+1}`})) }, { id: 'Program Pool', children: Array.from({length: 3}, (_, i) => ({id: `Program Pool - Zone ${i+1}`})) }, {id: 'Hydrotherapy Pool', children: []}, {id: 'Splash Pad', children: []}, {id: 'Club Room', children: []} ], 
                            eventTypes: { 'Class': '#3b82f6', 'Booking': '#16a34a', 'Closure': '#dc2626', 'Event': '#9333ea', 'Maintenance': '#facc15' },
                            openingHours: [ {day: 'Monday', open: 5, close: 19}, {day: 'Tuesday', open: 5, close: 19}, {day: 'Wednesday', open: 5, close: 19}, {day: 'Thursday', open: 5, close: 19}, {day: 'Friday', open: 5, close: 19}, {day: 'Saturday', open: 8, close: 18}, {day: 'Sunday', open: 8, close: 18} ]
                        };
                        db.collection('calendar_settings').doc('main_config').set(defaultSettings);
                        setSettings(defaultSettings);
                    }
                    settingsLoaded = true; checkLoading();
                }, err => setError(`Settings Error: ${err.message}`));
                
                const unsubEvents = db.collection('calendar_events')
                    .where('venue', '==', TARGET_VENUE)
                    .orderBy('startDateTime', 'desc')
                    .onSnapshot(snapshot => {
                        setEvents(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), startDateTime: doc.data().startDateTime.toDate(), endDateTime: doc.data().recurrence && doc.data().recurrence.endDate ? doc.data().recurrence.endDate.toDate() : doc.data().endDateTime.toDate() })));
                        eventsLoaded = true; checkLoading();
                    }, err => setError(`Events Error: ${err.message}`));
                return () => { unsubSettings(); unsubEvents(); };
            }, []);

            const openModal = (event = null) => { setSelectedEvent(event); setIsModalOpen(true); };
            const closeModal = () => { setIsModalOpen(false); setSelectedEvent(null); };

            const handleSaveEvent = async (eventData) => {
                if (!db) return;
                try {
                    const dataToSave = { ...eventData, venue: TARGET_VENUE };
                    if (dataToSave.recurrence && dataToSave.recurrence.endDate) {
                        const [year, month, day] = dataToSave.recurrence.endDate.split('-').map(Number);
                        const utcDate = new Date(Date.UTC(year, month - 1, day, 12, 0, 0));
                        dataToSave.recurrence.endDate = firebase.firestore.Timestamp.fromDate(utcDate);
                    }

                    if (selectedEvent) {
                        await db.collection('calendar_events').doc(selectedEvent.id).update(dataToSave);
                    } else {
                        await db.collection('calendar_events').add(dataToSave);
                    }
                    closeModal();
                } catch (err) { console.error("Error saving event:", err); setError(`Save failed: ${err.message}`); }
            };

            const handleDeleteEvent = async (id) => { if (window.confirm('Are you sure you want to delete this event series?')) { try { await db.collection('calendar_events').doc(id).delete(); } catch(err) { console.error(err); } } };
            const handleSaveSettings = async (newSettings) => { await db.collection('calendar_settings').doc('main_config').set(newSettings, { merge: true }); };

            const filteredEvents = useMemo(() => {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const endOfWeek = new Date(today);
                endOfWeek.setDate(today.getDate() + 6);
                const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

                return events.filter(event => {
                    const titleMatch = event.title.toLowerCase().includes(searchTerm.toLowerCase());
                    if (!titleMatch) return false;

                    const eventStart = new Date(event.startDateTime);
                    eventStart.setHours(0,0,0,0);
                    
                    switch(dateFilter) {
                        case 'today': return eventStart.getTime() === today.getTime();
                        case 'week': return eventStart >= today && eventStart <= endOfWeek;
                        case 'month': return eventStart.getMonth() === today.getMonth() && eventStart.getFullYear() === today.getFullYear();
                        default: return true;
                    }
                });
            }, [events, searchTerm, dateFilter]);


            if (isLoading) return <div className="text-center p-10">Loading Admin...</div>;
            return (
                <div className="container mx-auto p-6">
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-3xl font-bold">Calendar Admin: {TARGET_VENUE}</h1>
                        <div>
                             <button onClick={() => setIsSettingsOpen(true)} className="bg-gray-600 text-white px-4 py-2 rounded-lg font-semibold mr-4 hover:bg-gray-700">Settings</button>
                             <button onClick={() => openModal()} className="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700">Create New Event</button>
                        </div>
                    </div>
                     <div className="mb-4 flex flex-col md:flex-row gap-4">
                        <input type="text" placeholder="Search by title..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full md:w-1/3 p-2 border rounded-lg" />
                        <select value={dateFilter} onChange={e => setDateFilter(e.target.value)} className="w-full md:w-auto p-2 border rounded-lg bg-white">
                            <option value="all">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                    </div>
                    {error && <p className="text-red-500 bg-red-100 p-3 rounded-lg mb-4">{error}</p>}
                    <EventList events={filteredEvents} onEdit={openModal} onDelete={handleDeleteEvent} />
                    {isModalOpen && <EventForm event={selectedEvent} onSave={handleSaveEvent} onClose={closeModal} settings={settings} />}
                    {isSettingsOpen && <SettingsModal settings={settings} onSave={handleSaveSettings} onClose={() => setIsSettingsOpen(false)} />}
                </div>
            );
        };
        
        const EventList = ({ events, onEdit, onDelete }) => (
            <div className="bg-white shadow-md rounded-lg overflow-x-auto">
                <table className="min-w-full leading-normal">
                    <thead><tr>
                        <th className="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Title / Type</th>
                        <th className="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Time</th>
                        <th className="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Zones</th>
                        <th className="px-5 py-3 border-b-2 border-gray-200 bg-gray-100"></th>
                    </tr></thead>
                    <tbody>{events.map(event => <EventRow key={event.id} event={event} onEdit={onEdit} onDelete={onDelete} />)}</tbody>
                </table>
            </div>
        );

        const EventRow = ({ event, onEdit, onDelete }) => (
            <tr>
                <td className="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    <div className="flex items-center">
                        {event.recurrence && <span title="Recurring Event" className="mr-2">üîÅ</span>}
                        <div>
                            <p className="text-gray-900 font-bold whitespace-no-wrap">{event.title}</p>
                            <p className="text-gray-600 whitespace-no-wrap">{event.type}</p>
                        </div>
                    </div>
                </td>
                <td className="px-5 py-5 border-b border-gray-200 bg-white text-sm"><p className="text-gray-900 whitespace-no-wrap">{event.startDateTime.toLocaleString()}</p><p className="text-gray-600 whitespace-no-wrap">to {event.endDateTime.toLocaleString()}</p></td>
                <td className="px-5 py-5 border-b border-gray-200 bg-white text-sm"><p className="text-gray-900 whitespace-no-wrap max-w-xs truncate">{Array.isArray(event.zone) ? event.zone.join(', ') : ''}</p></td>
                <td className="px-5 py-5 border-b border-gray-200 bg-white text-sm text-right"><button onClick={() => onEdit(event)} className="text-blue-600 hover:text-blue-900 mr-2">Edit</button><button onClick={() => onDelete(event.id)} className="text-red-600 hover:text-red-900">Delete</button></td>
            </tr>
        );
        
        const EventForm = ({ event, onSave, onClose, settings }) => {
            const [formData, setFormData] = useState({ title: '', description: '', zone: [], type: 'Class', recurrence: null, venue: TARGET_VENUE });
            const [startDateTime, setStartDateTime] = useState('');
            const [endDateTime, setEndDateTime] = useState('');
            
            const toLocalISOString = (date) => { if (!date) return ''; const d = new Date(date); d.setMinutes(d.getMinutes() - d.getTimezoneOffset()); return d.toISOString().slice(0, 16); };
            const toLocalDateString = (date) => { if (!date) return ''; const d = new Date(date); d.setMinutes(d.getMinutes() - d.getTimezoneOffset()); return d.toISOString().split('T')[0]; };
            
            useEffect(() => {
                if (event) {
                    const initialFormData = {
                        title: event.title, description: event.description, zone: event.zone, type: event.type, venue: event.venue || TARGET_VENUE,
                        recurrence: event.recurrence ? { ...event.recurrence } : null
                    };
                    if (event.recurrence && event.recurrence.endDate) {
                        const endDate = event.recurrence.endDate.toDate ? event.recurrence.endDate.toDate() : new Date(event.recurrence.endDate);
                        initialFormData.recurrence.endDate = toLocalDateString(endDate);
                    }
                    setFormData(initialFormData);
                    setStartDateTime(toLocalISOString(event.startDateTime));
                    setEndDateTime(event.recurrence ? '' : toLocalISOString(event.endDateTime));
                } else {
                    const now = new Date(); now.setMinutes(0); const end = new Date(now); end.setHours(now.getHours() + 1);
                    setStartDateTime(toLocalISOString(now)); setEndDateTime(toLocalISOString(end));
                }
            }, [event]);

            const handleZoneChange = (e, zoneId, children = []) => {
                const isChecked = e.target.checked; let newZones = new Set(formData.zone);
                if (isChecked) { newZones.add(zoneId); children.forEach(c => newZones.add(c.id)); } 
                else { newZones.delete(zoneId); children.forEach(c => newZones.delete(c.id)); }
                setFormData(prev => ({ ...prev, zone: Array.from(newZones) }));
            };

            const handleChildZoneChange = (e, childId, parentId) => {
                const isChecked = e.target.checked; let newZones = new Set(formData.zone);
                if(isChecked) newZones.add(childId); else newZones.delete(childId);
                const parentZone = settings.zones.find(z => z.id === parentId);
                const allChildrenSelected = parentZone.children.every(c => newZones.has(c.id));
                if (allChildrenSelected) newZones.add(parentId); else newZones.delete(parentId);
                setFormData(prev => ({ ...prev, zone: Array.from(newZones) }));
            };
            
            const handleRecurrenceChange = (field, value) => {
                setFormData(prev => ({ ...prev, recurrence: { ...(prev.recurrence || { frequency: 'weekly', days: [] }), [field]: value } }));
            };
            
            const handleRecurrenceDayChange = (day) => {
                const currentDays = formData.recurrence?.days || []; const newDays = new Set(currentDays);
                if (newDays.has(day)) newDays.delete(day); else newDays.add(day);
                handleRecurrenceChange('days', Array.from(newDays));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                const sTime = new Date(startDateTime);
                const finalData = { ...formData, startDateTime: sTime };
                if (formData.recurrence) { finalData.endDateTime = sTime; } else { finalData.endDateTime = new Date(endDateTime); }
                onSave(finalData);
            };

            const isRecurring = !!formData.recurrence;

            return (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
                        <div className="p-6 border-b"><h2 className="text-2xl font-bold">{event ? 'Edit Event' : 'Create New Event'}</h2></div>
                        <form onSubmit={handleSubmit} className="flex-grow overflow-y-auto p-6 space-y-4">
                            <div><label>Title</label><input type="text" value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})} className="w-full p-2 border rounded-lg" required /></div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label>Start Time</label><input type="datetime-local" value={startDateTime} onChange={e => setStartDateTime(e.target.value)} className="w-full p-2 border rounded-lg" required /></div>
                                {!isRecurring && (<div><label>End Time</label><input type="datetime-local" value={endDateTime} onChange={e => setEndDateTime(e.target.value)} className="w-full p-2 border rounded-lg" required={!isRecurring} /></div>)}
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label>Event Type</label><select value={formData.type} onChange={e => setFormData({...formData, type: e.target.value})} className="w-full p-2 border rounded-lg"><option disabled>Select Type</option>{Object.keys(settings?.eventTypes || {}).map(type => <option key={type} value={type}>{type}</option>)}</select></div>
                                <div><label>Venue</label><select value={formData.venue} onChange={e => setFormData({...formData, venue: e.target.value})} className="w-full p-2 border rounded-lg bg-gray-200"><option value={TARGET_VENUE}>{TARGET_VENUE}</option></select></div>
                            </div>
                            <div className="space-y-2">
                                <h4 className="font-semibold">Zones</h4>
                                {settings?.zones?.map(zone => (
                                    <div key={zone.id} className="p-3 bg-gray-50 rounded-lg">
                                        <div className="flex items-center"><input type="checkbox" id={`zone-${zone.id}`} checked={formData.zone.includes(zone.id)} onChange={e => handleZoneChange(e, zone.id, zone.children)} className="h-4 w-4 mr-2" /><label htmlFor={`zone-${zone.id}`} className="font-bold">{zone.id}</label></div>
                                        {zone.children && zone.children.length > 0 && (<div className="grid grid-cols-2 md:grid-cols-4 gap-2 pl-6 pt-2">
                                            {zone.children.map(child => <div key={child.id}><input type="checkbox" id={`zone-${child.id}`} checked={formData.zone.includes(child.id)} onChange={e => handleChildZoneChange(e, child.id, zone.id)} className="h-4 w-4 mr-2" /><label htmlFor={`zone-${child.id}`} className="text-sm">{child.id.split(' - ')[1]}</label></div>)}
                                        </div>)}
                                    </div>
                                ))}
                            </div>
                            <div><label>Description</label><textarea value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})} className="w-full p-2 border rounded-lg" rows="3"></textarea></div>
                            <div className="space-y-3 pt-4 border-t">
                                <div className="flex items-center">
                                    <input type="checkbox" id="isRecurring" checked={isRecurring} onChange={(e) => setFormData(prev => ({...prev, recurrence: e.target.checked ? { frequency: 'weekly', days: [], endDate: '' } : null})) } className="h-4 w-4 mr-2" />
                                    <label htmlFor="isRecurring" className="font-semibold text-lg">üîÅ Recurring Event</label>
                                </div>
                                {isRecurring && (
                                    <div className="p-4 bg-blue-50 rounded-lg space-y-4">
                                        <div className="grid grid-cols-2 gap-4">
                                            <div><label>Repeats</label><select value={formData.recurrence.frequency} onChange={e => handleRecurrenceChange('frequency', e.target.value)} className="w-full p-2 border rounded-lg"><option value="weekly">Weekly</option></select></div>
                                            <div><label>Ends on</label><input type="date" value={formData.recurrence?.endDate || ''} onChange={e => handleRecurrenceChange('endDate', e.target.value)} className="w-full p-2 border rounded-lg" required={isRecurring} /></div>
                                        </div>
                                        <div>
                                            <label className="block mb-2">On</label>
                                            <div className="flex flex-wrap gap-2">
                                                {['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'].map(day => (
                                                    <button type="button" key={day} onClick={() => handleRecurrenceDayChange(day)} className={`px-3 py-1 rounded-full text-sm ${formData.recurrence.days.includes(day) ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}>{day.substring(0,3)}</button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </form>
                        <div className="p-4 bg-gray-50 border-t flex justify-end gap-3">
                            <button onClick={onClose} className="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                            <button onClick={handleSubmit} className="px-4 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">{event ? 'Save Changes' : 'Save Event'}</button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const SettingsModal = ({ settings, onSave, onClose }) => {
            const [localSettings, setLocalSettings] = useState(JSON.parse(JSON.stringify(settings))); const [activeTab, setActiveTab] = useState('zones'); const handleSave = () => { onSave(localSettings); onClose(); };
            return (<div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div className="bg-white rounded-lg shadow-xl w-full max-w-4xl h-[90vh] flex flex-col"><div className="p-4 border-b"><h2 className="text-2xl font-bold">Settings</h2></div><div className="flex-grow flex overflow-hidden"><nav className="w-1/4 bg-gray-50 p-4 border-r"><button onClick={() => setActiveTab('zones')} className={`block w-full text-left p-2 rounded-lg mb-2 ${activeTab === 'zones' ? 'bg-blue-100 text-blue-700' : ''}`}>Zones</button><button onClick={() => setActiveTab('eventTypes')} className={`block w-full text-left p-2 rounded-lg mb-2 ${activeTab === 'eventTypes' ? 'bg-blue-100 text-blue-700' : ''}`}>Event Types</button><button onClick={() => setActiveTab('hours')} className={`block w-full text-left p-2 rounded-lg ${activeTab === 'hours' ? 'bg-blue-100 text-blue-700' : ''}`}>Opening Hours</button></nav><main className="w-3/4 p-6 overflow-y-auto">{activeTab === 'zones' && <ZoneSettings settings={localSettings} setSettings={setLocalSettings} />}{activeTab === 'eventTypes' && <EventTypeSettings settings={localSettings} setSettings={setLocalSettings} />}{activeTab === 'hours' && <HoursSettings settings={localSettings} setSettings={setLocalSettings} />}</main></div><div className="p-4 bg-gray-50 border-t flex justify-end gap-3"><button onClick={onClose} className="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button><button onClick={handleSave} className="px-4 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">Save Changes</button></div></div></div>);
        };
        const ZoneSettings = ({ settings, setSettings }) => {
            const [newParentZone, setNewParentZone] = useState(''); const [newChildZone, setNewChildZone] = useState({ parentId: '', name: '' }); const addParent = () => { if(!newParentZone) return; setSettings(s => ({...s, zones: [...s.zones, {id: newParentZone, children: []}]})); setNewParentZone(''); }; const addChild = () => { if(!newChildZone.parentId || !newChildZone.name) return; setSettings(s => ({...s, zones: s.zones.map(p => p.id === newChildZone.parentId ? {...p, children: [...p.children, {id: `${p.id} - ${newChildZone.name}`}]} : p)})); setNewChildZone({parentId: '', name: ''}); }; const deleteZone = (idToDelete) => { setSettings(s => ({ ...s, zones: s.zones.filter(p => p.id !== idToDelete).map(p => ({...p, children: p.children.filter(c => c.id !== idToDelete)})) })) };
            return <div><h3 className="text-xl font-bold mb-4">Manage Zones</h3><div className="space-y-4">{settings.zones.map(p => (<div key={p.id} className="bg-gray-100 p-3 rounded-lg"><div className="flex justify-between items-center"><span className="font-semibold">{p.id}</span><button onClick={() => deleteZone(p.id)} className="text-red-500 text-xs">Delete</button></div><div className="pl-6 mt-2 space-y-1">{p.children?.map(c => (<div key={c.id} className="flex justify-between items-center"><span className="text-sm">{c.id}</span><button onClick={() => deleteZone(c.id)} className="text-red-500 text-xs">Delete</button></div>))}</div></div>))}</div><div className="mt-6 border-t pt-4 space-y-4"><div className="flex gap-2"><input value={newParentZone} onChange={e => setNewParentZone(e.target.value)} placeholder="New Parent Zone Name" className="flex-grow p-2 border rounded-lg"/><button onClick={addParent} className="px-4 py-2 bg-blue-500 text-white rounded-lg">Add</button></div><div className="flex gap-2"><select value={newChildZone.parentId} onChange={e => setNewChildZone({...newChildZone, parentId: e.target.value})} className="p-2 border rounded-lg"><option value="">Select Parent</option>{settings.zones.map(p=><option key={p.id} value={p.id}>{p.id}</option>)}</select><input value={newChildZone.name} onChange={e => setNewChildZone({...newChildZone, name: e.target.value})} placeholder="New Child Name (e.g. Lane 9)" className="flex-grow p-2 border rounded-lg" /><button onClick={addChild} className="px-4 py-2 bg-blue-500 text-white rounded-lg">Add</button></div></div></div>;
        };
        const EventTypeSettings = ({ settings, setSettings }) => {
            const [name, setName] = useState(''); const [color, setColor] = useState('#000000'); const add = () => { if (!name) return; setSettings(s => ({...s, eventTypes: {...s.eventTypes, [name]: color}})); setName(''); setColor('#000000'); }; const remove = (key) => { const newTypes = {...settings.eventTypes}; delete newTypes[key]; setSettings(s => ({...s, eventTypes: newTypes})); };
            return <div><h3 className="text-xl font-bold mb-4">Manage Event Types</h3><div className="space-y-2">{Object.entries(settings.eventTypes).map(([key, val])=>(<div key={key} className="flex items-center justify-between bg-gray-100 p-2 rounded-lg"><div className="flex items-center gap-3"><div className="w-6 h-6 rounded" style={{backgroundColor:val}}></div><span>{key}</span></div><button onClick={()=>remove(key)} className="text-red-500 text-xs">Delete</button></div>))}</div><div className="mt-6 border-t pt-4 flex gap-2"><input value={name} onChange={e=>setName(e.target.value)} placeholder="New Event Type" className="flex-grow p-2 border rounded-lg"/><input type="color" value={color} onChange={e=>setColor(e.target.value)} className="w-16 h-10 border rounded-lg" style={{padding: '0.2rem'}}/><button onClick={add} className="px-4 py-2 bg-blue-500 text-white rounded-lg">Add</button></div></div>;
        };
        const HoursSettings = ({ settings, setSettings }) => {
            const handleHourChange = (day, field, value) => { setSettings(s => ({...s, openingHours: s.openingHours.map(h => h.day === day ? {...h, [field]: parseInt(value)} : h)})); };
            return <div><h3 className="text-xl font-bold mb-4">Manage Opening Hours</h3><div className="space-y-2">{settings.openingHours.map(h=>(<div key={h.day} className="grid grid-cols-3 items-center gap-4 bg-gray-100 p-2 rounded-lg"><span className="font-semibold">{h.day}</span><div><label className="text-xs">Open</label><select value={h.open} onChange={e => handleHourChange(h.day, 'open', e.target.value)} className="w-full p-2 border rounded-lg">{Array.from({length:24},(_,i)=><option key={i} value={i}>{`${i}:00`}</option>)}</select></div><div><label className="text-xs">Close</label><select value={h.close} onChange={e => handleHourChange(h.day, 'close', e.target.value)} className="w-full p-2 border rounded-lg">{Array.from({length:24},(_,i)=><option key={i} value={i}>{`${i}:00`}</option>)}</select></div></div>))}</div></div>;
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

